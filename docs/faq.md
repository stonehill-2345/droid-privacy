# 常见问题解答 (FAQ)

## 概述

本文档为DroidPrivacy工具使用过程中的常见问题及解答，帮助用户快速解决使用中遇到的问题。

## 目录

### 基础了解
- [工具支持检测的内容有哪些](#工具支持检测的内容有哪些)
- [工具检测的规则的依据是什么](#工具检测的规则的依据是什么)
- [工具检测出来的内容都是不合规的吗](#工具检测出来的内容都是不合规的吗)

### 环境要求
- [手机必须root吗](#手机必须root吗)
- [支持哪些Android版本](#支持哪些android版本)
- [支持哪些设备类型](#支持哪些设备类型)

### 配置使用
- [如何配置检测项目](#如何配置检测项目)
- [支持同时检测多个应用吗](#支持同时检测多个应用吗)
- [什么情况下需要重启手机](#什么情况下需要重启手机)

### 运行验证
- [如何判断工具已正常运行](#如何判断工具已正常运行)
- [如何验证检测是否生效](#如何验证检测是否生效)
- [工具没有正常运行怎么办](#工具没有正常运行怎么办)

### 结果处理
- [检测结果文件保存在哪里](#检测结果文件保存在哪里)
- [如何分析检测结果](#如何分析检测结果)
- [LogCat中的日志与检测结果中的文件不同步](#logcat中的日志与检测结果中的文件不同步)

### 故障排除
- [检测结果为空怎么办](#检测结果为空怎么办)
- [工具无法检测某些应用怎么办](#工具无法检测某些应用怎么办)
- [检测到大量重复调用怎么办](#检测到大量重复调用怎么办)

### 高级功能
- [什么是手机品牌模拟](#什么是手机品牌模拟)
- [什么是重载调用过滤](#什么是重载调用过滤)
- [什么是系统广播发送](#什么是系统广播发送)
- [行为分类是如何判定的](#行为分类是如何判定的)
- [可以新增或修改检测规则吗](#可以新增或修改检测规则吗)
- [可以自定义检测结果的处理逻辑吗](#可以自定义检测结果的处理逻辑吗)

### 其他问题
- [工具对应用性能有影响吗](#工具对应用性能有影响吗)
- [手机和模拟器运行该工具结果一样吗](#手机和模拟器运行该工具结果一样吗)

---

## 基础了解

### 工具支持检测的内容有哪些

**答：** 详见：[检测规则](detection_rules.md)

### 工具检测的规则的依据是什么

**答：** 工具检测的规则参考了市面常见三方的合规检测工具。如在使用过程中对检测规则的分类、检测规则的具体内容等有疑问和建议，欢迎提交Issue进行交流和反馈。

### 工具检测出来的内容都是不合规的吗

**答：** 工具只负责检测个人信息和设备信息的获取，不支持合规判定。是否合规需要用户结合法律法规、应用市场和监管部门的相关要求等综合判定。

## 环境要求

### 手机必须root吗

**答：** DroidPrivacy基于Xposed开发，基本前提为手机已root成功获取最高权限，所以必须root。不局限于手机，模拟器root后也可正常运行该工具。

### 支持哪些Android版本

**答：** 支持Android 8.1至Android 14系统。建议使用Android 10及以上版本以获得更好的兼容性和稳定性。不同Android版本在API可用性和行为上可能存在差异。

### 支持哪些设备类型

**答：** 支持所有已Root的Android设备，包括：
- **手机**：各种品牌的Android手机
- **平板**：Android平板设备
- **模拟器**：已Root的Android模拟器
- **开发板**：支持Android的开发板

## 配置使用

### 如何配置检测项目

**答：** 在DroidPrivacy应用主界面勾选需要检测的项目类型，点击"保存配置"即可。支持全选、取消全选、展开/折叠分类等操作。配置保存后，下次启动目标应用时自动生效。

**重要提醒：不建议勾选所有检测规则**

**高频调用规则（会产生大量记录）：**
- **eg1：系统属性（包含设备信息、网络状态、SIM卡状态等多种系统属性读取）**：应用频繁调用SystemProperties获取系统信息
- **eg1：网络信息（：包含网络类型、连接状态等频繁调用的网络相关API）**：网络状态检查、连接状态等调用频繁

**建议配置策略：**
1. **按需选择**：根据实际检测需求选择相关规则，避免全选
2. **重点关注**：优先选择高敏感度规则（标记为"高敏"的项目）
3. **分阶段检测**：可以分多次检测，每次选择不同类别的规则
4. **性能考虑**：减少不必要的规则可以降低性能影响和文件大小


### 支持同时检测多个应用吗

**答：** 支持，在LSPosed管理器中勾选需要检测的应用即可。

### 什么情况下需要重启手机

**答：** 以下情况需要重启手机：

**必须重启的情况：**
- 首次安装DroidPrivacy模块后
- LSPosed框架更新后
- Magisk或系统级模块更新后

**理论上不需要重启，但可能遇到不生效的情况：**
- 检测规则变更 - 通常下次启动目标应用时自动生效
- 手机品牌模拟变更 - 通常下次启动目标应用时自动生效
- 重载调用过滤变更 - 通常下次启动目标应用时自动生效
- 在LSPosed中勾选/取消勾选应用 - 通常立即生效

**遇到配置不生效时的解决方案：**
1. **首先尝试**：重新启动目标应用
2. **如果仍不生效**：重启手机
3. **常见不生效场景**：
   - 跨进程配置同步延迟
   - LSPosed执行异常
   - 系统内存不足导致模块卸载
   - 目标应用的反Xposed检测干扰

**说明：** 虽然大部分配置变更理论上无需重启，但在实际使用中可能会遇到各种异常情况，此时重启是可尝试的解决方案。

## 运行验证

### 如何判断工具已正常运行

**答：** 可通过以下方式判断：

1. **LogCat日志检查**：
   - 在LogCat中过滤"DroidPrivacy"标签
   - 如果观察到相应日志，则说明工具已正常运行

2. **Toast提示检查**：
   - 打开需要检测的应用
   - 如果看到"开始检测xx"的toast提示，则说明工具已正常运行

### 如何验证检测是否生效

**答：** 可通过以下方式验证：
1. **Toast提示**：打开目标应用，观察是否出现"开始检测xx"的Toast提示
2. **LogCat日志**：在LogCat中过滤"DroidPrivacy"标签，查看相关日志
3. **功能测试**：执行一些可能触发隐私API的操作，检查是否有检测记录
4. **结果文件**：检查检测结果文件是否生成并包含预期内容

### 工具没有正常运行怎么办

**答：** 请按以下步骤排查：

1. **环境检查**：
   - 确认是否已root成功
   - 确认Magisk、LSPosed是否已正确安装

2. **模块检查**：
   - 打开LSPosed管理器
   - 确认"DroidPrivacy"模块是否已启用

3. **应用配置检查**：
   - 如模块已启用，则确认需要检测的应用是否已勾选

4. **重启设备**：
   - 如以上步骤均无问题，重启手机
   - 部分场景下LSPosed执行异常，重启可解决

5. **提交Issue**：
   - 如工具仍然没有正常运行，请提交Issue进行反馈

## 结果处理

### 检测结果文件保存在哪里

**答：** 根据是否授予存储写权限，保存路径不同：

- 已授予WRITE_EXTERNAL_STORAGE：`/sdcard/DroidPrivacy`
- 未授予WRITE_EXTERNAL_STORAGE：`/sdcard/Android/data/com.privacy2345.droidprivacy/files/DroidPrivacy`

文件按包名与日期生成Excel（.xlsx），包含触发时间、行为分类、调用方法、堆栈等信息。具体路径也可在应用“结果设置”页面查看。

此外，“本机输出（写入Excel）”功能默认是开启的，可在应用“结果设置”页面通过“本机输出”开关随时启用/关闭。

### 如何分析检测结果

**答：** 检测结果文件包含以下信息：
- **触发序号**：API调用的顺序编号
- **触发时间**：具体的调用时间
- **行为主体**：识别调用来源（App本身或第三方SDK）
- **行为分类**：隐私行为的分类（如定位、设备信息等）
- **行为描述**：具体的API调用描述
- **触发方法**：被调用的具体方法名
- **堆栈信息**：完整的调用堆栈

### LogCat中的日志与检测结果中的文件不同步

**答：** 检测结果采用缓存+定时写入策略，定时任务每10秒触发一次（批量通过广播写入文件），因此存在延迟：
**建议等待时间：**
- 常规场景：等待20~30秒后再获取结果文件
- 高并发/大量调用：等待约60秒以确保写入完成
如仍未看到更新，可再等待一个周期或重试一次。

## 故障排除

### 检测结果为空怎么办

**答：** 如果检测结果为空，请检查：
1. **应用选择**：确认目标应用已在LSPosed中勾选
2. **检测项目**：确认已选择相应的检测项目
3. **应用操作**：确认已执行可能触发隐私API的操作

### 工具无法检测某些应用怎么办

**答：** 如果工具无法检测某些应用：
1. **检查应用选择**：确认应用已在LSPosed中勾选
2. **检查应用类型**：某些系统应用或特殊应用可能无法检测
3. **检查反检测机制**：应用可能具有反Xposed检测机制
4. **重启设备**：尝试重启设备重新加载模块
5. **提交反馈**：如问题持续存在，请提交Issue反馈

### 检测到大量重复调用怎么办

**答：** 如果检测到大量重复调用：
1. **启用重载调用过滤**：在检查工具页面启用该功能
2. **分析调用模式**：查看是否为正常的重载调用
3. **检查应用行为**：确认是否为应用本身的异常行为

## 高级功能

### 什么是手机品牌模拟

**答：** 通过修改Build.BRAND和Build.MANUFACTURER系统属性实现修改应用获取到的手机品牌。如应用存在根据手机品牌执行不同代码的逻辑，通过手机品牌模拟可快速测试对应业务逻辑。

### 什么是重载调用过滤

**答：** 如一个类中存在多个重载方法，且重载方法之间存在互相调用，会存在1次执行触发多条调用记录的情况，该情况会干扰排查，重载调用过滤功能通过检测时间间隔和堆栈信息匹配来识别并过滤这类重复调用。当前过滤算法无法识别所有重载调用情况，分析时仍需注意重复记录。

**功能特点：**
- **默认开启**：重载调用过滤功能默认启用，可在"检查工具"页面手动关闭
- **过滤机制**：基于时间间隔和堆栈信息匹配来识别重复调用
- **局限性**：当前算法无法识别所有重载调用情况，分析时仍需注意重复记录

### 什么是系统广播发送

**答：** 系统广播发送功能用于模拟发送Android系统广播，测试应用对广播的接收和响应行为。

**主要用途：**

**1. 测试广播接收**
- 模拟发送各种系统广播（如开机广播、网络状态变化广播等）
- 检测目标应用是否注册了相应的广播监听器
- 观察应用在接收到广播后的响应行为

**2. 测试自启动行为**
- 在某些合规规定中，应用接收广播后自动启动会被判定为自启动行为
- 通过模拟发送广播，可以测试应用是否存在违规的自启动行为
- 帮助识别应用是否在后台通过广播监听实现自启动

**3. 隐私行为检测**
- 记录应用在接收广播时触发的隐私API调用
- 分析应用是否在广播响应过程中获取敏感信息
- 检测应用是否利用广播机制进行不当的数据收集

**技术实现：**
- 通过Hook `Context.sendBroadcast()` 和 `Context.sendOrderedBroadcast()` 方法
- 支持模拟发送常见的系统广播类型
- 记录广播发送和接收的完整过程
- 与隐私API检测结合，提供完整的广播行为分析

**⚠️ 使用注意事项：**
- 部分系统广播可能导致桌面应用崩溃，建议在测试环境中谨慎使用
- 建议先测试非关键应用，避免影响系统稳定性
- 如遇到应用崩溃，可重启应用或设备恢复正常
- 某些系统级广播可能影响系统正常运行，使用时需格外小心


### 行为主体是如何判定的

**答：** 根据堆栈中的包名进行判定，存在三方SDK未加入规则或判定不准确的问题，如发现该问题请提交Issue进行反馈。

### 可以新增或修改检测规则吗

**答：** 可在代码中新增/调整规则与对应的Hook方法。

**关键位置：**
- 规则常量：`app/src/main/java/com/privacy2345/droidprivacy/constant/Behavior.java`（`Category`/`Rule`）
- 规则实现：`app/src/main/java/com/privacy2345/droidprivacy/hook/HookConfigManager.java`

**实现步骤：**
1. 在`Behavior.Rule`中新增规则常量（必要时在`Behavior.Category`中新增分类）。
2. 在`HookConfigManager`中：
   - 为新规则新增`addXxx()`方法或在现有`addXxx()`中追加`HookMethod.Builder`配置；
   - 如需按参数判定分类/规则（减少误报），可为`HookMethod`设置`HookedMethodListener`（参考`addSystemProperties()`）。
3. 在`HookConfigManager.getConfig()`末尾构建UI可选项时，补充`checkItemList.add(getCheckItem(...))`，使新规则可在应用内勾选。
4. 编译并在测试环境验证：触发目标API，确认日志与结果文件记录正确。

**注意事项：**
- 优先Hook具体方法，谨慎对抽象方法进行全量类遍历（会带来一次性启动开销）。
- 新增高敏项时请清晰命名并归类，便于分析与检索。
- 与现有规则保持一致的命名与代码风格，便于维护。

**参与方式：**
- **二次开发**：Fork项目进行自定义开发，满足特定需求
- **提交Issue**：发现新规则需求或现有规则问题，欢迎提交Issue讨论
- **贡献代码**：完善检测规则后，可提交Pull Request贡献给项目

## 其他问题

### 工具对应用性能有影响吗

**答：** 工具对应用性能的影响主要体现在以下几个方面：

**Hook机制影响：**
- 工具通过Xposed Hook技术拦截API调用，每次调用都会增加少量开销
- 对于抽象方法Hook，需要遍历应用的所有类（通过DexFile解析），在应用启动时会有一次性性能消耗
- Hook操作在应用启动时执行，运行时开销相对较小

**数据写入影响：**
- Excel文件写入采用缓存+定时策略（10秒周期），避免频繁IO操作
- 单文件超过1500行时会自动分文件，防止文件过大影响性能

**建议：**
- 在测试环境中使用，避免在生产环境长期运行
- 如遇到性能问题，可减少检测项目或关闭重载调用过滤
- 大量API调用的应用建议适当延长检测间隔

### 可以自定义检测结果的处理逻辑吗

**答：** 可以，DroidPrivacy采用开源架构，支持用户根据需求自定义修改代码。

**核心扩展点：**

**1. 数据写入逻辑自定义**
- **文件位置**：`app/src/main/java/com/privacy2345/droidprivacy/output/DataWriteExcelManager.java`
- **扩展方式**：修改`writeFile()`方法，处理自定义文件格式（JSON、CSV、数据库等）
- **示例场景**：将结果写入数据库、发送到自定义API接口、生成自定义报告格式

**2. 数据上传逻辑自定义**
- **文件位置**：`app/src/main/java/com/privacy2345/droidprivacy/output/DataUploadManager.java`
- **扩展方式**：修改`upload()`方法，支持上传到自定义服务器
- **示例场景**：集成企业内部系统、上传到云存储、发送到监控平台

**参与方式：**
- **二次开发**：Fork项目进行自定义开发，满足特定业务需求
- **提交Issue**：发现处理逻辑问题或新需求，欢迎提交Issue讨论
- **贡献代码**：完善处理逻辑后，可提交Pull Request贡献给项目

### 手机和模拟器运行该工具结果一样吗

**答：** 基本一致，除了模拟器无法模拟的部分，比如根据不同手机厂商而执行的差异化代码、手机蓝牙等。

---

## 技术支持

如遇到本文档未涵盖的问题，请参考[问题反馈指南](feedback.md)获取完整的反馈指导。